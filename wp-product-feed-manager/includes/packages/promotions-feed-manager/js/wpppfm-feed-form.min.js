function wpppfm_initializeMerchantPromotionsFeedForm(e){jQuery("#wppfm-main-input-map").empty(),wppfm_showWorkingSpinner(),window.location=encodeURI(window.location.href+"&feed-type=google-merchant-promotions-feed&feed-name="+e)}function wpppfm_initiatePromotionsFeedHolder(e){var o=jQuery("#wppfm-feed-editor-page-data-storage").data("wppfmFeedData");o&&(o.feed_file_name=""===o.feed_file_name?e:o.feed_file_name,o.feed_type_id="3",o.status_id="2",o.url=jQuery("#wppfm-feed-editor-page-data-storage").data("wppfmFeedUrl")+"/wppfm-feeds/"+o.feed_file_name+".xml",o&&(_promotionsFeedHolder=new Feed(o.feed_id,o.feed_file_name,0,0,1,"",[],o.url,"1","US","","",o.feed_title,o.feed_description,"",[],o.status_id,"3"),wpppfm_constructPromotionFromFeedData(o.attribute_data).forEach(function(e){_promotionsFeedHolder.addPromotion(e)}),_promotionsFeedHolder.promotion_destination_options=o.promotion_destination_options,_promotionsFeedHolder.promotion_filter_options=o.promotion_filter_options,wppfm_constructNewSpecialFeed(_promotionsFeedHolder),_promotionsFeedHolder))}function wpppfm_fillPromotionFields(){var e=-1===_feedHolder.feedId;if(!e){jQuery("#wppfm-feed-file-name").val(_promotionsFeedHolder.title),wppfm_setMerchantSelector(e,_feedHolder.channel),wppfm_setGoogleFeedTypeSelector(e,_feedHolder.feedType);for(var o=wpppfm_getPromotionData(_promotionsFeedHolder.promotions),p=0;p<o.length;p++){if("generic_code"===_promotionsFeedHolder.getPromotionCouponCodeRequiredValue(p)){var t=_promotionsFeedHolder.promotions[p].find(e=>"generic_redemption_code"===e.meta_key);t&&jQuery(`#wpppfm-generic-redemption-code-input-field-${p}`).val(t.meta_value),jQuery("#wpppfm-generic-redemption-code-input-row").show()}"specific_products"===_promotionsFeedHolder.getPromotionProductsEligibleForPromotionValue(p)&&jQuery(`#wppfm-product-filter-map-${p}`).show(),wpppfm_requiredDataIsFilledIn(p)&&(jQuery(`#wpppfm-product-details-map-${p}`).show(),wppfm_enableFeedActionButtons("google-merchant-promotions-feed")),wpppfm_fillInTheFormFields(p)}}}function wpppfm_initiateDatePickers(e){var o={dateFormat:"DD-MM-YYYY hh:mm",firstDayOfWeek:"1",closeOnSelected:!0,autodateOnStart:!1,locale:wppfm_script_vars.language.slice(0,2)};jQuery(`#wpppfm-promotion-effective-start-date-input-field-${e}`).appendDtpicker(o),jQuery(`#wpppfm-promotion-effective-end-date-input-field-${e}`).appendDtpicker(o),jQuery(`#wpppfm-promotion-display-start-date-input-field-${e}`).appendDtpicker(o),jQuery(`#wpppfm-promotion-display-end-date-input-field-${e}`).appendDtpicker(o)}function wpppfm_promotionsInputChanged(e,o){if("input not set"===wpppfm_storePresetInputsInPromotions(e,o)){var p=e.replaceAll("_","-"),t=jQuery(`#wpppfm-${p}-input-field-${o}`).val();_promotionsFeedHolder.addPromotionElement(o,e,t)}"generic_code"===jQuery(`#wpppfm-offer-type-input-field-${o}`).val()?jQuery(`#wpppfm-generic-redemption-code-input-row-${o}`).show():jQuery(`#wpppfm-generic-redemption-code-input-row-${o}`).hide(),"specific_products"===jQuery(`#wpppfm-product-applicability-input-field-${o}`).val()?jQuery(`#wppfm-product-filter-map-${o}`).show():jQuery(`#wppfm-product-filter-map-${o}`).hide(),wpppfm_requiredDataIsFilledIn(o)&&(jQuery(`#wpppfm-product-details-map-${o}`).show(),wppfm_enableFeedActionButtons("google-merchant-promotions-feed"))}function wpppfm_storePresetInputsInPromotions(e,o){var p=["offer_type","product_applicability","redemption_channel","promotion_destination"];return p.forEach(function(e){var p=e.replaceAll("_","-"),t=jQuery(`#wpppfm-${p}-input-field-${o}`).val();_promotionsFeedHolder.addPromotionElement(o,e,t)}),p.includes(e)?"input set":"input not set"}function wpppfm_initiateSaveAndGeneratePromotionsFeed(){wppfm_showWorkingSpinner(),wppfm_showInfoMessage(wppfm_feed_settings_form_vars.feed_preparing+' <span class="wppfm-processing-dots"></span>'),wppfm_hideWorkingSpinner(),wppfm_disableFeedActionButtons("google-merchant-promotions-feed"),wppfm_saveFeedToDb(_promotionsFeedHolder,function(e){wpppfm_handleSavePromotionsFeedToDbResult(e,!_promotionsFeedHolder.feedId),wppfm_updateFeedFile(_promotionsFeedHolder.feedId,function(e){wppfm_handleUpdateFeedFileActionResult(e),wppfm_hideWorkingSpinner()})})}function wpppfm_handleSavePromotionsFeedToDbResult(e,o){0===e||"0"===e?wppfm_handleSaveFeedToDbFailedAction():(_promotionsFeedHolder.feedId=e,o&&(wppfm_resetUrlForNewFeed(_promotionsFeedHolder.feedId,"google-merchant-promotions-feed"),wppfm_storeFeedUrlInSourceData(_promotionsFeedHolder.url)))}function wpppfm_fillInTheFormFields(e){JSON.parse(JSON.stringify(_promotionsFeedHolder.promotions[e])).forEach(function(o){if("genericRedemptionCode"!==o.meta_key){var p=o.meta_key.replaceAll("_","-");"free_shipping"===o.meta_key||"coupon_value_type"===o.meta_key?jQuery(`#wpppfm-${p}-input-field-${e} option[value="${o.meta_value}"]`).prop("selected",!0):"product_filter_selector_include"===o.meta_key||"product_filter_selector_exclude"===o.meta_key||"promotion_destination"===o.meta_key?jQuery(`#wpppfm-${p}-input-field-${e}`).val(o.meta_value).trigger("change"):jQuery(`#wpppfm-${p}-input-field-${e}`).val(o.meta_value)}})}function wpppfm_constructPromotionFromFeedData(e){if(0===e.length)return[[]];var o=[];return JSON.parse(e[0].meta_value).forEach(function(e){var p=[];e.forEach(function(e){if("promotion_effective_dates"===e.meta_key){var o=e.meta_value.split("/");p.push({meta_key:"promotion_effective_start_date",meta_value:o[0]}),p.push({meta_key:"promotion_effective_end_date",meta_value:o[1]})}else p.push(e)}),o.push(p)}),o}jQuery(function(){var e=wppfm_getUrlParameter("feed-name");"google-merchant-promotions-feed"===wppfm_getUrlParameter("feed-type")&&(wppfm_showWorkingSpinner(),wpppfm_initiatePromotionsFeedHolder(e),jQuery("#wppfm-feed-types-list-row").show(),jQuery(".wppfm-top-buttons-wrapper").show(),_feedHolder.promotions.forEach(function(e,o){wpppfm_addPromotionElement(o)}),wpppfm_tunePromotionElements(),wpppfm_fillPromotionFields(),_feedHolder.promotions.length>2&&jQuery(".wppfm-center-buttons-wrapper").show(),jQuery(".wppfm-bottom-buttons-wrapper").show(),wppfm_hideWorkingSpinner())});